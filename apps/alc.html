<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alcohol Rater</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .star-rating svg {
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }
        .star-rating svg:hover {
            transform: scale(1.1);
        }
        .badge-color-wine { background-color: #f59e0b; color: #78350f; } /* Amber */
        .badge-color-beer { background-color: #d1d5db; color: #4b5563; } /* Gray */
        .badge-color-spirit { background-color: #6ee7b7; color: #065f46; } /* Emerald */
        .badge-color-cocktail { background-color: #c084fc; color: #581c87; } /* Purple */
        .badge-color-cider { background-color: #84cc16; color: #365314; } /* Lime */
        .badge-color-sake { background-color: #38bdf8; color: #075985; } /* Sky */
        .badge-color-liquor { background-color: #e879f9; color: #701a75; } /* Fuchsia */
        .badge-color-other { background-color: #6b7280; color: #f3f4f6; } /* Dark Gray */

        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .rating-card {
            display: flex;
            align-items: center;
            transition: all 0.3s ease-in-out;
        }
        .rating-card.expanded {
            flex-direction: column;
            align-items: stretch;
        }
        .rating-card .card-image-container {
            flex-shrink: 0;
            width: 64px;
            height: 64px;
            transition: all 0.3s ease-in-out;
        }
        .rating-card.expanded .card-image-container {
            width: 100%;
            height: 200px;
        }
        .rating-card .card-content {
            flex-grow: 1;
            padding-left: 1rem;
        }
        .rating-card.expanded .card-content {
            padding-left: 0;
            padding-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 md:p-8">

    <div id="app" class="w-full max-w-sm bg-white rounded-3xl shadow-2xl p-6 md:p-8">

        <!-- Title -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-purple-800">Alcohol Rater</h1>
            <p class="text-gray-600 font-semibold mt-2">Rate and remember your favorite drinks</p>
        </div>

        <!-- Rating Form -->
        <form id="ratingForm" class="space-y-6">
            <div>
                <label for="drinkName" class="block text-sm font-semibold text-gray-700 mb-2">Drink Name</label>
                <input type="text" id="drinkName" placeholder="e.g., Old Fashioned" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" required>
            </div>
            <div>
                <label for="drinkType" class="block text-sm font-semibold text-gray-700 mb-2">Drink Type</label>
                <select id="drinkType" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all appearance-none bg-white" required>
                    <option value="">Select a type...</option>
                    <option value="Beer">Beer</option>
                    <option value="Cider">Cider</option>
                    <option value="Wine">Wine</option>
                    <option value="Whiskey">Whiskey</option>
                    <option value="Sake">Sake</option>
                    <option value="Spirit">Spirit</option>
                    <option value="Cocktail">Cocktail</option>
                    <option value="Liquor">Liquor</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div>
                <label for="notes" class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
                <textarea id="notes" placeholder="What did you think of it?" class="w-full px-5 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all h-24"></textarea>
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Image</label>
                <div class="relative w-24 h-24 mb-4 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center overflow-hidden">
                    <img id="imagePreview" src="" alt="Image Preview" class="w-full h-full object-cover hidden">
                    <label for="imageUpload" class="absolute w-full h-full flex items-center justify-center cursor-pointer text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.842-1.263a2 2 0 011.664-.89h.93a2 2 0 012 2v.93a2 2 0 00.89 1.664l1.263.842a2 2 0 01.89 1.664v.93a2 2 0 01-2 2h-.93a2 2 0 00-1.664.89l-.842 1.263a2 2 0 01-1.664.89h-.93a2 2 0 01-2-2v-.93a2 2 0 00-.89-1.664l-1.263-.842A2 2 0 013 13.93V13a2 2 0 01-2-2v-1a2 2 0 012-2z"></path>
                        </svg>
                    </label>
                    <input type="file" id="imageUpload" accept="image/*" capture="user" class="hidden">
                </div>
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Rating</label>
                <div id="starRating" class="flex items-center text-xl text-yellow-400 space-x-1">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24" data-value="1"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24" data-value="2"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24" data-value="3"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24" data-value="4"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24" data-value="5"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
                </div>
                <input type="hidden" id="rating" value="0" required>
            </div>
            <button type="submit" class="w-full py-4 px-4 bg-blue-600 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">Save Rating</button>
            <div id="messageBox" class="text-center text-sm mt-4 hidden"></div>
        </form>

        <div class="mt-10">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">My Ratings</h2>
            <div class="flex space-x-2 mb-6">
                <button id="filterBest" class="flex-1 py-3 px-4 bg-green-500 text-white font-semibold rounded-xl hover:bg-green-600 transition-colors">Best</button>
                <button id="filterWorst" class="flex-1 py-3 px-4 bg-red-500 text-white font-semibold rounded-xl hover:bg-red-600 transition-colors">Worst</button>
            </div>
            <div id="ratingsList" class="space-y-4">
                <!-- Ratings will be dynamically added here -->
            </div>
        </div>
    </div>
    
    <!-- Hidden canvas for image resizing -->
    <canvas id="imageCanvas" class="hidden"></canvas>

    <script>
        // UI elements
        const ratingForm = document.getElementById('ratingForm');
        const drinkNameInput = document.getElementById('drinkName');
        const drinkTypeInput = document.getElementById('drinkType');
        const notesInput = document.getElementById('notes');
        const imageUploadInput = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const imageCanvas = document.getElementById('imageCanvas');
        const ratingInput = document.getElementById('rating');
        const ratingsList = document.getElementById('ratingsList');
        const messageBox = document.getElementById('messageBox');
        const filterBestBtn = document.getElementById('filterBest');
        const filterWorstBtn = document.getElementById('filterWorst');
        const starRatingContainer = document.getElementById('starRating');
        const stars = starRatingContainer.querySelectorAll('svg');

        let currentRating = 0;
        let base64Image = null;

        // Function to show a temporary message
        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.className = `text-center text-sm mt-4 px-4 py-2 rounded-lg ${isError ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        }

        // Load ratings from localStorage
        function getRatings() {
            try {
                const storedRatings = localStorage.getItem('drinkRatings');
                if (storedRatings) {
                    return JSON.parse(storedRatings);
                }
            } catch (error) {
                console.error("Error parsing localStorage data:", error);
            }
            // Return an empty array if no ratings are found
            return [];
        }

        // Save ratings to localStorage
        function saveRatings(ratings) {
            localStorage.setItem('drinkRatings', JSON.stringify(ratings));
        }

        // Delete a rating
        function deleteRating(id) {
            let ratings = getRatings();
            ratings = ratings.filter(rating => rating.id !== id);
            saveRatings(ratings);
            renderRatings(ratings);
            showMessage("Rating deleted successfully!");
        }

        // Render the ratings list
        function renderRatings(ratingsToRender) {
            ratingsList.innerHTML = ''; // Clear the list
            if (ratingsToRender.length === 0) {
                ratingsList.innerHTML = '<p class="text-center text-gray-500">No ratings yet. Add one above!</p>';
            } else {
                ratingsToRender.forEach(rating => {
                    const ratingItem = document.createElement('div');
                    ratingItem.className = "bg-white rounded-xl shadow-lg transform transition-transform hover:scale-[1.01] duration-300 ease-in-out overflow-hidden p-4 mb-4 rating-card relative";
                    
                    const starsHTML = Array.from({ length: 5 }, (_, i) => {
                        return `<svg class="w-5 h-5 ${i < rating.rating ? 'text-yellow-400' : 'text-gray-300'}" fill="currentColor" viewBox="0 0 24 24"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>`;
                    }).join('');

                    // Determine badge color based on drink type
                    let badgeColorClass = 'badge-color-other';
                    switch(rating.drinkType) {
                        case 'Wine':
                            badgeColorClass = 'badge-color-wine';
                            break;
                        case 'Beer':
                            badgeColorClass = 'badge-color-beer';
                            break;
                        case 'Whiskey':
                        case 'Spirit':
                            badgeColorClass = 'badge-color-spirit';
                            break;
                        case 'Cocktail':
                            badgeColorClass = 'badge-color-cocktail';
                            break;
                        case 'Cider':
                            badgeColorClass = 'badge-color-cider';
                            break;
                        case 'Sake':
                            badgeColorClass = 'badge-color-sake';
                            break;
                        case 'Liquor':
                            badgeColorClass = 'badge-color-liquor';
                            break;
                    }

                    ratingItem.innerHTML = `
                        <div class="card-image-container mr-4">
                            <img src="${rating.imageUrl}" alt="${rating.drinkName}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/E5E7EB/4B5563?text=${encodeURIComponent(rating.drinkName.charAt(0))}'" class="w-full h-full rounded-lg object-cover shadow-sm">
                        </div>
                        <div class="card-content flex-1">
                            <h3 class="text-lg font-semibold text-gray-800">${rating.drinkName}</h3>
                            <div class="mt-1 flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${badgeColorClass}">${rating.drinkType}</span>
                                <div class="flex items-center space-x-0.5">
                                    ${starsHTML}
                                </div>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">${rating.notes}</p>
                        </div>
                        <button class="absolute top-2 right-2 p-1 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors" data-id="${rating.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    `;
                    
                    // Add event listener for the delete button
                    ratingItem.querySelector('button').addEventListener('click', (event) => {
                        event.stopPropagation(); // Prevents the card expansion
                        const id = parseInt(event.currentTarget.dataset.id);
                        deleteRating(id);
                    });

                    ratingItem.addEventListener('click', () => {
                        ratingItem.classList.toggle('expanded');
                    });

                    ratingsList.appendChild(ratingItem);
                });
            }
        }

        // Star rating functionality
        function updateStarRating(rating) {
            currentRating = rating;
            ratingInput.value = currentRating;
            stars.forEach((star, index) => {
                if (index < currentRating) {
                    star.classList.add('text-yellow-400');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
        }

        starRatingContainer.addEventListener('click', (e) => {
            const target = e.target.closest('svg');
            if (target) {
                const value = parseInt(target.dataset.value, 10);
                updateStarRating(value);
            }
        });

        // Image handling from camera input
        imageUploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const MAX_WIDTH = 400;
                        const MAX_HEIGHT = 400;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }

                        imageCanvas.width = width;
                        imageCanvas.height = height;
                        const ctx = imageCanvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        base64Image = imageCanvas.toDataURL('image/jpeg', 0.4);
                        imagePreview.src = base64Image;
                        imagePreview.classList.remove('hidden');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Add a new rating to localStorage
        function addRating(e) {
            e.preventDefault();
            
            const drinkName = drinkNameInput.value.trim();
            const drinkType = drinkTypeInput.value;
            const notes = notesInput.value.trim();
            const rating = parseInt(ratingInput.value, 10);

            if (!drinkName || !drinkType || isNaN(rating) || rating < 1 || rating > 5) {
                showMessage("Please enter a valid drink name, select a type, and a rating between 1 and 5.", true);
                return;
            }

            const newRating = {
                id: Date.now(),
                drinkName,
                drinkType,
                notes,
                imageUrl: base64Image || `https://placehold.co/100x100/E5E7EB/4B5563?text=${encodeURIComponent(drinkName.charAt(0))}`,
                rating,
            };

            const ratings = getRatings();
            ratings.unshift(newRating); // Add new rating to the top
            saveRatings(ratings);
            renderRatings(ratings);

            showMessage("Rating saved successfully!");
            ratingForm.reset();
            updateStarRating(0); // Reset stars after submission
            base64Image = null; // Reset base64 image
            imagePreview.classList.add('hidden');
            imagePreview.src = "";
        }

        // Event listener for the form submission
        ratingForm.addEventListener('submit', addRating);

        // Event listeners for filter buttons
        filterBestBtn.addEventListener('click', () => {
            const ratings = getRatings();
            ratings.sort((a, b) => b.rating - a.rating);
            renderRatings(ratings);
        });

        filterWorstBtn.addEventListener('click', () => {
            const ratings = getRatings();
            ratings.sort((a, b) => a.rating - b.rating);
            renderRatings(ratings);
        });

        // Initial render on page load
        document.addEventListener('DOMContentLoaded', () => {
            const initialRatings = getRatings();
            renderRatings(initialRatings);
            updateStarRating(0);
        });
    </script>
</body>
</html>
